#!/usr/bin/env ruby
# Usage: b00m NAME URL
#
# Integrates boom (http://github.com/holman/boom) with your Dropbox Public
# directory, so you won't be at mercy of someone else's hosting your images,
# just Dropbox.
require 'open-uri'
require 'boom'

name, url, _ = ARGV

if name.nil? || url.nil?
  puts "Usage: #{File.basename($0)} NAME URL"
  exit 1
end

list = Boom::List.find(url.end_with?('.gif') ? 'gifs' : 'pics')
destination = "#{list.name}/#{name}#{File.extname(url)}"

File.open(File.expand_path("~/Dropbox/Public/boom/#{destination}"), 'w+b') do |file|
  file.puts open(url, 'rb').read
end

item = Boom::Item.new(name, "https://dl.dropboxusercontent.com/u/#{ENV['DROPBOX_USER_ID']}/#{destination}")

list.add_item(item)
Boom.storage.save

puts "ðŸ’¾  '#{File.basename(destination)}' saved."
