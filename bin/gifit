#!/bin/bash
# USAGE: gifit [MOVIE]
#
# This program will convert the .mov MOVIE file into a gif with the same name,
# copy it over to ~/Dropbox/Public/gifs and copy the Dropbox public URL for the
# gif to your clipboard.The gif conversion commands are extracted from
# https://gist.github.com/SlexAxton/4989674.
#
# The Dropbox copy requires the 'DROPBOX_USER_ID' variable to be set.

if [[ ! -f "$1" ]]; then
  echo "Usage: $(basename $0) MOVIE.mov"
  exit 1
fi

movie="$1"
gif=${movie/.mov/.gif}
filename=$(basename $gif)

ffmpeg -i $movie -r 10 -vcodec png out-static-%05d.png 2> /dev/null
convert -verbose +dither -layers Optimize -resize 600x600\> out-static*.png  gif:-  2> /dev/null | gifsicle --colors 128 --delay=1 --loop --optimize=3 --multifile - > $gif
rm out-static*.png

echo "ðŸŽ¥ '$filename' created."

if [[ -n "$DROPBOX_USER_ID" ]]; then
  mkdir -p ~/Dropbox/Public/gifs
  mv $gif ~/Dropbox/Public/gifs
  echo -n "https://dl.dropboxusercontent.com/u/$DROPBOX_USER_ID/gifs/$filename" | pbcopy
  echo "ðŸ‘‰ Public Dropbox URL for '$filename' copied to your clipboard."
fi
